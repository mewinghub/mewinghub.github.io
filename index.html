<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mewhub.com</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<center>
    <div class="menu-container">
        <ul>
            <li><a href=""></a></li>
            <li><a href=""><img src="file:///C:/Users/peteij/Downloads/icons8-menu-94.png" height="35px"></a></li>
            <li><a href=""><img src="file:///C:/Users/peteij/Downloads/icons8-male-user-94.png" height="35px"></a></li>
            <li><a href=""><img src="file:///C:/Users/peteij/Downloads/icons8-camera-94.png" height="35px"></a></li>
            <li><a href=""><img src="file:///C:/Users/peteij/Downloads/icons8-about-94.png" height="35px"></a></li>
        </ul>
      </div>
<div class="container">
  <form id="image-upload-form">
    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(event)" style="margin: 8px;">
    <input type="text" id="nameInput" placeholder="Your Name" style="margin: 8px;">
    <hr style="width: 35em; margin: 0.75em;">
    <button type="button" onclick="uploadImage()">Upload Image</button>
  </form>
  <div id="imagePreview"></div>
</div>
<div class="backdrop">
  <div id="image-gallery" class="image-gallery"></div>
</div>
</center>
<script>
function displayImages(images) {
    var imageGallery = document.getElementById('image-gallery');
    imageGallery.innerHTML = '';
    images.forEach(function(image, index) {
        var imageContainer = document.createElement('div');
        imageContainer.className = 'image-container';

        var img = document.createElement('img');
        img.src = image.imageUrl;
        img.style.maxWidth = '100%';
        imageContainer.appendChild(img);

        var likesCount = document.createElement('span');
        likesCount.textContent = 'Likes: ' + image.likes;
        imageContainer.appendChild(likesCount);

        imageGallery.appendChild(imageContainer);
    });
}

// Fetch images from server
function fetchImages() {
    fetch('/images')
        .then(response => response.json())
        .then(images => {
            displayImages(images);
        })
        .catch(error => console.error('Error fetching images:', error));
}

// Initial display of images
fetchImages();

function previewImage(event) {
    const imagePreview = document.getElementById('imagePreview');
    imagePreview.innerHTML = '';
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function() {
        const img = document.createElement('img');
        img.src = reader.result;
        imagePreview.appendChild(img);
    }

    reader.readAsDataURL(file);
}

function uploadImage() {
    const nameInput = document.getElementById('nameInput').value;
    const imageFile = document.getElementById('imageInput').files[0];

    if (!nameInput || !imageFile) {
        alert('Please enter your name and choose an image.');
        return;
    }

    const formData = new FormData();
    formData.append('name', nameInput);
    formData.append('image', imageFile);

    fetch('/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            alert('Image uploaded successfully.');
            document.getElementById('nameInput').value = '';
            document.getElementById('imageInput').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            fetchImages(); // Refresh images after upload
        } else {
            alert('Failed to upload image.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again later.');
    });
}
</script>
</body>
</html>
