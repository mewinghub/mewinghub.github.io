<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mewhub.com</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<center>
    <div class="menu-container">
        <ul>
            <li><a href=""><img src="icons8-email-94.png" height="35px"></a></li>
            <li><a href=""><img src="icons8-menu-94.png" height="35px"></a></li>
            <li><a href=""><img src="icons8-about-94.png" height="35px"></a></li>
            <li><a href=""><img src="icons8-camera-94.png" height="35px"></a></li>
            <li><a href=""><img src="icons8-plus-94.png" height="35px"></a></li>
        </ul>
      </div>
<div class="container">
  <form id="image-upload-form">
    <input type="text" id="nameInput" placeholder="Your Name" style="margin: 8px;">
    <hr style="width: 35em; margin: 0.75em;">
    <button type="button" id="take-photo-button">Take Photo</button>
  </form>
</div>
<div class="backdrop">
  <div id="image-gallery" class="image-gallery"></div>
</div>
</center>
<script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js"></script>
<script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyD8MILnn0mxAjIymYunOJ9PeOcS8TREN-s",
    authDomain: "mewinghub.firebaseapp.com",
    projectId: "mewinghub",
    storageBucket: "mewinghub.appspot.com",
    messagingSenderId: "1002076070934",
    appId: "1:1002076070934:web:74e962a275a0c64c514137",
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the Firebase storage service
const storage = firebase.storage();

// Function to display uploaded images in the gallery
function displayImages() {
    var imageGallery = document.getElementById('image-gallery');
    imageGallery.innerHTML = '';

    uploadedImages.forEach(function(image, index) {
        var imageContainer = document.createElement('div');
        imageContainer.className = 'image-container';

        var img = document.createElement('img');
        img.src = image.imageUrl;
        img.style.maxWidth = '100%';
        imageContainer.appendChild(img);

        var createdBy = document.createElement('span');
        createdBy.textContent = 'Uploaded by: ' + image.name;
        imageContainer.appendChild(createdBy);

        var likeButton = document.createElement('button');
        likeButton.textContent = 'Like';
        likeButton.addEventListener('click', function() {
            likeImage(index);
        });
        imageContainer.appendChild(likeButton);

        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.addEventListener('click', function() {
            deleteImage(index);
        });
        imageContainer.appendChild(deleteButton);

        var likesCount = document.createElement('span');
        likesCount.textContent = 'Likes: ' + image.likes;
        imageContainer.appendChild(likesCount);

        imageGallery.appendChild(imageContainer);
    });
}

// Function to handle taking a photo using the camera
document.getElementById('take-photo-button').addEventListener('click', function() {
    var constraints = { video: true };

    navigator.mediaDevices.getUserMedia(constraints)
        .then(function(stream) {
            var video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');

            video.addEventListener('canplay', function() {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                var imageUrl = canvas.toDataURL('image/png');
                saveImageToFirebase(imageUrl);
            });
        })
        .catch(function(err) {
            console.error('Error accessing camera: ', err);
        });
});

// Function to save image to Firebase Storage
function saveImageToFirebase(imageUrl) {
    const nameInput = document.getElementById('nameInput').value;

    if (!nameInput) {
        alert('Please enter your name.');
        return;
    }

    // Generate a random image filename
    const filename = Math.random().toString(36).substring(7) + '.png';

    // Create a reference to the Firebase storage location
    const storageRef = storage.ref().child(filename);

    // Convert data URL to Blob
    const blob = dataURLtoBlob(imageUrl);

    // Upload the image file to Firebase Storage
    storageRef.put(blob).then(function(snapshot) {
        console.log('Image uploaded successfully:', snapshot);
        // Get the public URL of the uploaded image
        storageRef.getDownloadURL().then(function(downloadURL) {
            // Save the uploaded image data to Firebase Realtime Database
            firebase.database().ref('images').push({
                name: nameInput,
                imageUrl: downloadURL,
                likes: 0
            });
            // Display the updated images
            displayImages();
        });
    }).catch(function(error) {
        console.error('Error uploading image:', error);
        alert('Failed to upload image.');
    });
}

// Function to delete an image
function deleteImage(index) {
    // Delete the image from Firebase Storage
    const storageRef = storage.refFromURL(uploadedImages[index].imageUrl);
    storageRef.delete().then(function() {
        console.log('Image deleted successfully');
        // Remove the image data from Firebase Realtime Database
        firebase.database().ref('images').child(Object.keys(uploadedImages)[index]).remove();
        // Display the updated images
        displayImages();
    }).catch(function(error) {
        console.error('Error deleting image:', error);
        alert('Failed to delete image.');
    });
}

// Function to like an image
function likeImage(index) {
    const imageKey = Object.keys(uploadedImages)[index];
    firebase.database().ref('images/' + imageKey + '/likes').transaction(function(likes) {
        return (likes || 0) + 1;
    }).then(function() {
        console.log('Image liked successfully');
        // Display the updated images
        displayImages();
    }).catch(function(error) {
        console.error('Error liking image:', error);
        alert('Failed to like image.');
    });
}

// Function to convert data URL to Blob
function dataURLtoBlob(dataURL) {
    var arr = dataURL.split(',');
    var mime = arr[0].match(/:(.*?);/)[1];
    var bstr = atob(arr[1]);
    var n = bstr.length;
    var u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
}
</body>
</html>
